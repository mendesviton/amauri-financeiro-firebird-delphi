unit uLog;

interface

uses
   Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, uCad_padrao, Vcl.StdCtrls, Vcl.Buttons,
  Vcl.ExtCtrls, Vcl.ComCtrls,Vcl.Mask,uControleSQL,DB, Vcl.Imaging.jpeg,uUtilAmauri,uConsts;

type
  TLOG = class
    private
      SQLGlobal:TExecSQL;
    FDataAtual: string;
      procedure pCriaObj;
      procedure pDestroiObj;
    procedure SetDataAtual(const Value: string);

    public
      {Métodos de inserção  de log}

      procedure AddLog(prCodUsu,prCodTela,prTipoAcao,prData,prDescricao:string);
      destructor Destroy; override;
      property DataAtual:string read FDataAtual write SetDataAtual;
  end;

implementation

{ TLOG }

procedure TLOG.AddLog(prCodUsu, prCodTela, prTipoAcao, prData,
  prDescricao: string);
var
  wSQL:string;
begin
  pCriaObj;
     {executa a stored procedure que monta o sql de insert da tabela de tlog}
     SQLGlobal.CommandText.SQL.Clear;
     wSQL:='EXECUTE PROCEDURE '+C_SP_INSERIR_LOG+'('+prCodUsu+','+prCodTela+','+prTipoAcao+','+prDescricao+','+DataAtual+')';
     SQLGlobal.CommandText.CommandText:=wSQL;
     SQLGlobal.CommandText.ExecSQL;
end;

destructor TLOG.Destroy;
begin
  pDestroiObj;
  inherited;
end;

procedure TLOG.pCriaObj;
begin
  if not Assigned(SQLGlobal) then
     SQLGlobal:=TExecSQL.Create;

  DataAtual:=TUtil.FConverteDataAAAAMMDD(datetostr(date));
end;

procedure TLOG.pDestroiObj;
begin
  if  Assigned(SQLGlobal) then
     FreeAndNil(SQLGlobal);
end;

procedure TLOG.SetDataAtual(const Value: string);
begin
  FDataAtual := Value;
end;

end.
